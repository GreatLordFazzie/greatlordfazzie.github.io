<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop – Hideous Tome</title>
  <link rel="stylesheet" href="styles-new.css" />
</head>
<body>

  <header class="site-banner">
    <div class="banner-inner">
      <img src="images/Hideous Tome Logo.png" alt="Hideous Tome" class="logo" />
      <button class="hamburger" aria-label="Menu">☰</button>
      <nav class="banner-nav">
          <a href="about.html">ABOUT</a>
          <a href="gallery.html">GALLERY</a>
          <a href="shop.html" class="active">SHOP</a>
      </nav>
    </div>
  </header>

  <main class="shop-main">
    <section class="shop-section">
      <h2 class="shop-heading">BOOKS</h2>
      <div class="shop-grid shop-grid-books"></div>
    </section>

    <section class="shop-section">
      <h2 class="shop-heading">PRINTS</h2>
      <div class="shop-grid shop-grid-prints"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-left-text">PRAISE VELOK 2025</div>
      <div class="footer-links">
        <a href="index.html" target="_blank">V 1.0</a>
        <a href="#" class="active">V 2.0</a>
      </div>
    </div>
  </footer>
<!-- Modal: image-first lightbox (no buy button) -->
<div id="product-modal" class="product-modal">
  <div class="modal-content">
    <button class="modal-close" aria-label="Close">&times;</button>

    <div class="modal-left">
      <div class="carousel" id="modal-carousel">
        <button class="carousel-nav prev" aria-label="Previous">&#10094;</button>
        <img id="carousel-image" src="" alt="" />
        <div class="price-chip" id="carousel-chip">Print Only — $15</div>
        <button class="carousel-nav next" aria-label="Next">&#10095;</button>
      </div>
      <div class="carousel-dots" id="carousel-dots"></div>
    </div>

    <!-- tiny overlay card: just title/price (no BUY) -->
    <div class="modal-right">
      <h2 id="modal-title"></h2>
      <p class="modal-price" id="modal-price"></p>
    </div>
  </div>
</div>
<script src="shop-data.js"></script>
<script src="banner-toggle.js"></script>
  <script>
    const products = window.products || [];
    const toCard = (p) => {
      const imgSrc = p.type === 'print' ? (p.images?.[0] || p.img) : p.img;
      const priceLabel = p.type === 'print'
          ? `From $${(p.pricePrint || 15).toFixed(2)}`
          : `$${(p.price || 0).toFixed(2)}`;

      // pack print meta for modal
      const dataAttrs = p.type === 'print'
        ? `data-images='${JSON.stringify(p.images || [imgSrc])}'
          data-kinds='${JSON.stringify(p.kinds || ["print"])}'
          data-buy-print='${p.buyPrint || "#"}'
          data-buy-framed='${p.buyFramed || "#"}'
          data-price-print='${p.pricePrint || 15}'
          data-price-framed='${p.priceFramed || 45}'`
        : `data-buy='${p.buy || "#"}'`;

      return `
        <article class="shop-card ${p.featured ? 'feature' : ''}" data-type="${p.type}"
                data-title="${p.title}" ${dataAttrs}>
          ${p.badge ? `<span class="badge">${p.badge}</span>` : ``}

          <!-- Clicking this image opens modal immediately -->
          <div class="shop-media ${p.type === 'print' ? 'open-print-trigger' : ''}" role="button" tabindex="0" aria-label="View ${p.title}">
            <img src="${imgSrc}" alt="${p.alt || p.title}">
          </div>

          <h2 class="shop-title">${p.title}</h2>
<!--          <p class="shop-price">${priceLabel}</p> -->
          ${
            p.type === 'book'
              ? `<a href="${p.buy}" class="buy-button" target="_blank" rel="noopener">BUY NOW</a>`
              : `
                <div class="buy-row compact">
                  <a href="${p.buyPrint}" class="btn-option" target="_blank" rel="noopener">
                    <span class="btn-label">PRINT ONLY</span>
                    <span class="btn-price">$${(p.pricePrint||15).toFixed(2)}</span>
                  </a>
                  <a href="${p.buyFramed}" class="btn-option framed" target="_blank" rel="noopener">
                    <span class="btn-label">FRAMED EDITION</span>
                    <span class="btn-price">$${(p.priceFramed||45).toFixed(2)}</span>
                  </a>
                </div>`
          }
        </article>
      `;
    };

    const books  = products.filter(p => p.type === 'book');
    const prints = products.filter(p => p.type === 'print');

    const gridBooks  = document.querySelector('.shop-grid-books');
    const gridPrints = document.querySelector('.shop-grid-prints');

    if (gridBooks)  gridBooks.innerHTML  = books.map(toCard).join('');
    if (gridPrints) gridPrints.innerHTML = prints.map(toCard).join('');

    // Modal wiring (NOTE: no modal BUY now)
    const modal = document.getElementById('product-modal');
    const modalClose = document.querySelector('.modal-close');
    const modalTitle = document.getElementById('modal-title');
    const modalPrice = document.getElementById('modal-price');

    const carouselImg = document.getElementById('carousel-image');
    const carouselDots = document.getElementById('carousel-dots');
    const prevBtn = document.querySelector('.carousel-nav.prev');
    const nextBtn = document.querySelector('.carousel-nav.next');
    const chip = document.getElementById('carousel-chip');

    let currentImages = [];
    let currentKinds = [];
    let currentIndex = 0;
    let currentPricePrint = 15;
    let currentPriceFramed = 45;

    function setCarousel(idx) {
      if (!currentImages.length) return;
      currentIndex = (idx + currentImages.length) % currentImages.length;
      carouselImg.src = currentImages[currentIndex];

      const kind = currentKinds[currentIndex] || 'print';
      const isFramed = kind === 'framed';
      const price = isFramed ? currentPriceFramed : currentPricePrint;

      chip.textContent   = isFramed ? `Framed Edition — $${price.toFixed(2)}` : `Print Only — $${price.toFixed(2)}`;
      modalPrice.textContent = `$${price.toFixed(2)}`;

      carouselDots.innerHTML = currentImages
        .map((_, i) => {
          const k = currentKinds[i] || 'print';
          return `<button class="dot ${i===currentIndex?'active':''} ${k}" data-i="${i}" aria-label="${k} image ${i+1}"></button>`;
        }).join('');
    }

    // open the modal immediately when the image area is clicked or keyed
    function openFromCard(card){
      modal.classList.add('active');
      modalTitle.textContent = card.dataset.title;

      try { currentImages = JSON.parse(card.dataset.images || '[]'); } catch { currentImages = []; }
      try { currentKinds  = JSON.parse(card.dataset.kinds  || '[]'); } catch { currentKinds  = []; }
      currentPricePrint  = parseFloat(card.dataset.pricePrint || '15');
      currentPriceFramed = parseFloat(card.dataset.priceFramed || '45');
      setCarousel(0);
    }

    document.addEventListener('click', (e) => {
      const trigger = e.target.closest('.open-print-trigger'); // the image container
      if (trigger) {
        const card = trigger.closest('.shop-card');
        if (card && card.dataset.type === 'print') {
          e.preventDefault();
          openFromCard(card);
        }
      }
    });
    document.addEventListener('keydown', (e) => {
      if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('open-print-trigger')) {
        e.preventDefault();
        const card = e.target.closest('.shop-card');
        if (card && card.dataset.type === 'print') openFromCard(card);
      }
    });

    prevBtn.addEventListener('click', () => setCarousel(currentIndex - 1));
    nextBtn.addEventListener('click', () => setCarousel(currentIndex + 1));
    modalClose.addEventListener('click', () => modal.classList.remove('active'));
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active');
  });
</script>
</body>
</html>
